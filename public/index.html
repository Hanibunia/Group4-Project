<!DOCTYPE html>
<html>

<head>
    <title>DVOPS - Restaurant Review Web App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://kit.fontawesome.com/c40c131336.js" crossorigin="anonymous"></script>
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,700|Roboto:400,700&display=swap" rel="stylesheet">
  


    <link href="css/style.css" rel="stylesheet" />
    <link href="css/review.css" rel="stylesheet" />

    <script src="js/Restaurant.js"></script>
    <script src="js/Login.js"></script>

    <script src="js/common.js"></script>
    <script src="js/Restaurant.js"></script>
    <script src="js/Reviews.js"></script>
    <script src="js/Profile.js"></script>

</head>

<body onload="loadRestaurants();">
    <!-- Navigation -->
    <nav class="container-fluid navbar navbar-expand-md">
        <a class="navbar-brand" href="#">
            ArkFood <!-- Replace "#" with the actual link to your website's home page if available -->
        </a>

        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" type="search" placeholder="Search by Restaurant Name"
                aria-label="Search" id="searchInput">
            <button id="searchBtn" class="btn btn-outline-success my-2 my-sm-0" type="button"
                onclick="searchRestaurants(document.getElementById('searchInput').value)">Search</button>
        </form>

        <ul class="navbar-nav">
            <div class="collapse navbar-collapse ml-auto" id="navContent">
                <div class="d-flex ml-auto flex-column flex-lg-row align-items-center">
                    <ul class="navbar-nav">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html"><span class="fa fa-home"></span> Home</a>
                        </li>
                        <li class="nav-item" id="navUser">
                            <a class="nav-link" href="#" data-toggle="modal" data-target="#loginForm"
                                onclick="toggleLogin()">
                                <span class="fa-sharp fa-solid fa-right-to-bracket"></span>
                                <span id="loginStatus">Login</span>
                            </a>
                        </li>
                        <li class="nav-item" id="navMyProfile">
                            <a class="nav-link" href="#" id="myProfileTab" data-toggle="modal"
                                data-target="#myProfileModal">
                                <span class="fas fa-user"></span> My Profile
                            </a>
                        </li>

                    </ul>
        </ul>
        </div>
        </div>
    </nav>
    <!-- Banner -->
    <div class="container-fluid banner">
        <div class="row">
            <div class="col-md-4 offset-md-2">
                <h1>Become your dream restaurant here</h1>
                <a href="#" onclick="getRestaurant(999)" class="btn btn-warning">View all Restaurants</a>
            </div>
            <div class="col-md-4"><img src="images/banner.png" width="100%"></div>
        </div>
    </div>
    <div class="container mt-4" id="restaurantList">
        <!-- Assume each restaurant object has a property 'id' -->
        <div class="restaurant-item" onclick="handleRestaurantItemClick('${restaurant.id}')">


            <!-- Display restaurant information here -->
        </div>
    </div>
    <!-- Login Modal -->
    <div class="modal fade" id="loginForm" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Login </h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm">
                            <form>
                                <div class="form-group">
                                    <label id="loginLabelID">Email</label>
                                    <input type="email" class="form-control" id="loginEmail">
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" class="form-control" id="loginPassword">
                                </div>

                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <a href="#" data-dismiss="modal" data-toggle="modal" data-target="#registerForm"
                                id="Register">Not a user? Register here.</a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning"  id="LoginButton" onclick="loginUser()">Login</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Register Modal -->
    <div class="modal fade" id="registerForm" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Register </h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-sm">
                            <form>
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-control" id="Email">
                                </div>
                                <div class="form-group">
                                    <label>Password</label>
                                    <input type="password" class="form-control" id="password">
                                </div>
                                <div class="form-group">
                                    <label>Confirm Password</label>
                                    <input type="password" class="form-control" id="confirm-password">
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm">
                            <a href="#" data-dismiss="modal" data-toggle="modal" data-target="#loginForm">Already a
                                user?
                                Login here.</a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" onclick="registerUser()"
                        id="registerButtonId">Register</button>
                </div>
                <div id="registerError" class="text-danger text-center mt-2"></div>

            </div>
        </div>
    </div>
    <!-- Add a modal for displaying reviews -->
    <div class="modal fade reviews-modal" id="reviewsModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Reviews</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>

                <div class="modal-body" id="reviewsModalBody">
                    <!-- Reviews content will be appended here -->
                </div>
                <div class="modal-footer">
                    <!-- Button to open the add review form modal -->
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addReviewModal"
                        id="addReviewButton">Add Review</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for the add review form -->
    <div class="modal fade" id="addReviewModal" tabindex="-1" role="dialog" aria-labelledby="addReviewModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="addReviewModalLabel">Add Review</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!-- Add Review Form -->
                <form id="addReviewForm">
                    <div class="modal-body">

                        <div class="form-group">
                            <label for="email">Email:</label>
                            <input type="email" class="form-control" id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="reviewText">Review:</label>
                            <textarea class="form-control" id="reviewText" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="rating">Rating:</label>
                            <input type="number" class="form-control" id="rating" min="1" max="5" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Submit Review</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </div>
    <!-- Modal for updating a review -->
    <div class="modal fade" id="updateReviewModal" tabindex="-1" role="dialog" aria-labelledby="updateReviewModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title" id="updateReviewModalLabel">Update Review</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <!-- Update Review Form -->
                <form id="updateReviewForm">
                    <div class="modal-body">

                        <div class="form-group">
                            <label for="updatedReviewText">Updated Review:</label>
                            <textarea class="form-control" id="updatedReviewText" rows="3" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="updatedRating">Updated Rating:</label>
                            <input type="number" class="form-control" id="updatedRating" min="1" max="5" required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-primary">Update Review</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
    <div class="modal fade" id="myProfileModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">My Profile</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Add content for My Profile here (e.g., user information) -->
                    <p>Welcome User</p>

                    <!-- Add more user information if needed -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#updateEmailModal">
                        Change Email
                    </button>
                </div>
            </div>
        </div>
    </div>
    <!-- Modal for changing email -->
    <div class="modal fade" id="updateEmailModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title">Update Email</h2>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Add a form for updating the email -->
                    <form id="updateEmailForm">
                        <div class="form-group">
                            <label for="currentEmail">Current Email:</label>
                            <input type="email" id="currentEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="newEmail">New Email:</label>
                            <input type="email" id="newEmail" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-primary" onclick="updateEmail()">Update Email</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>



    <script>
        document.getElementById('addReviewForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const email = document.getElementById('email').value;
            const reviewText = document.getElementById('reviewText').value;
            const rating = parseInt(document.getElementById('rating').value, 10);

            try {
                // Call the addReview function with the form data and the stored restaurant ID
                addReview(email, reviewText, rating);
            } catch (error) {
                console.error('An error occurred while getting the restaurant ID:', error);
            }
        });

        // Listen for the update form submission
        document.getElementById('updateReviewForm').addEventListener('submit', function (event) {
            event.preventDefault();

            const updatedReviewText = document.getElementById('updatedReviewText').value;
            const updatedRating = document.getElementById('updatedRating').value;

            // Retrieve the review ID from the data attribute
            const reviewId = $('#updateReviewModal').data('reviewId');
            const email = $('#updateReviewModal').data('email');

            // Call the function to update the review
            updateReview(email, reviewId, updatedReviewText, updatedRating);

            // Close the update modal after submission
            $('#updateReviewModal').modal('hide');
        });

        // Function to update the "Add Review" button visibility based on login status
        function updateAddReviewButtonVisibility() {
            const user = JSON.parse(localStorage.getItem('user'));
            const addReviewButton = document.getElementById('addReviewButton');

            if (user) {
                // User is logged in, show the "Add Review" button
                addReviewButton.style.display = 'block';
            } else {
                // User is not logged in, hide the "Add Review" button
                addReviewButton.style.display = 'none';
            }
        }
        function updateMyProfileTabVisibility() {
            const user = JSON.parse(localStorage.getItem('user'));
            const myProfileTab = document.getElementById('myProfileTab');

            if (user) {
                // User is logged in, show the "My Profile" tab
                myProfileTab.style.display = 'block';
            } else {
                // User is not logged in, hide the "My Profile" tab
                myProfileTab.style.display = 'none';
            }
        }
        // Check the login status when the page loads
        document.addEventListener('DOMContentLoaded', function () {
            // Check the login status
            updateAddReviewButtonVisibility();
            updateMyProfileTabVisibility();
        });

        // Add an event listener for changes in login status
        window.addEventListener('storage', function (e) {
            if (e.key === 'user') {
                // Login status changed, update the "Add Review" button visibility
                updateAddReviewButtonVisibility();
                updateMyProfileTabVisibility();
            }
        });

        document.addEventListener('DOMContentLoaded', checkLoggedIn);
        document.getElementById('deleteReviewForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const reviewId = document.getElementById('reviewId').value;

            try {
                deleteReview(reviewId);
            } catch (error) {
                console.error('An error occurred while deleting the review:', error);
            }
        });
        document.addEventListener('DOMContentLoaded', function () {
            // Check the login status for the "Add Review" button
            updateAddReviewButtonVisibility();

            // Check the login status for the "My Profile" tab
            updateMyProfileTabVisibility();
        });

        // Add an event listener for changes in login status
        window.addEventListener('storage', function (e) {
            if (e.key === 'user') {
                // Login status changed, update the "Add Review" button and "My Profile" tab visibility
                updateAddReviewButtonVisibility();
                updateMyProfileTabVisibility();
            }
        });
        document.getElementById('myProfileModal').addEventListener('show.bs.modal', function () {
    const user = JSON.parse(localStorage.getItem('user'));
    if (user) {
        // Update the email content in the modal
        document.getElementById('email').textContent = user.email;
    }
});
document.addEventListener('DOMContentLoaded', function () {
    document.getElementById('updateEmailForm').addEventListener('submit', async function (event) {
        event.preventDefault();

        const currentEmail = document.getElementById('currentEmail').value;
        const newEmail = document.getElementById('newEmail').value;

        try {
            await updateUserEmail(currentEmail, newEmail);
            // Optionally, you can close the modal or update the UI
            document.getElementById('updateEmailModal').style.display = 'none';
        } catch (error) {
            console.error('An error occurred:', error);
        }
    });
});

    </script>
</body>

</html>